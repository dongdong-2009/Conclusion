; generated by ARM C/C++ Compiler, 4.1 [Build 894]
; commandline ArmCC [--list --split_sections --debug -c --asm --interleave -odac8554.o --asm_dir=.\ --list_dir=.\ --depend=dac8554.d --cpu=Cortex-M3 --apcs=interwork -O3 -I..\ -I..\..\..\Libraries\CMSIS\CM3\CoreSupport -I..\..\..\Libraries\CMSIS\CM3\DeviceSupport\ST\STM32F10x -I..\..\..\Libraries\STM32F10x_StdPeriph_Driver\inc -I..\..\..\Utilities\STM32_EVAL -I..\..\..\Utilities\STM32_EVAL\Common -I..\..\..\Utilities\STM32_EVAL\STM3210E_EVAL -IC:\Keil\ARM\RV31\Inc -IC:\Keil\ARM\CMSIS\Include -D__MICROLIB -DUSE_STDPERIPH_DRIVER -DSTM32F10X_HD -DUSE_STM3210E_EVAL --omf_browse=dac8554.crf ..\DAC8554.c]
                          THUMB

                          AREA ||i.DAC8554_GPIO_Config||, CODE, READONLY, ALIGN=2

                  DAC8554_GPIO_Config PROC
;;;3      u16 Dat;
;;;4      void DAC8554_GPIO_Config(void)
000000  b538              PUSH     {r3-r5,lr}
;;;5      {
;;;6      	GPIO_InitTypeDef  GPIO_InitStructure;
;;;7      
;;;8      	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOD, ENABLE);	 //使能PA端口时钟
000002  2101              MOVS     r1,#1
000004  2020              MOVS     r0,#0x20
000006  f7fffffe          BL       RCC_APB2PeriphClockCmd
;;;9      
;;;10     	GPIO_InitStructure.GPIO_Pin = SYNC_Pin | SCLK_Pin | DIN_Pin | LDAC_Pin;				 // 端口配置
00000a  200f              MOVS     r0,#0xf
00000c  f8ad0000          STRH     r0,[sp,#0]
;;;11     	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP; 		 //推挽输出
000010  2010              MOVS     r0,#0x10
000012  f88d0003          STRB     r0,[sp,#3]
;;;12     	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_10MHz;
000016  2001              MOVS     r0,#1
;;;13     	GPIO_Init(GPIOD, &GPIO_InitStructure);
000018  4c05              LDR      r4,|L1.48|
00001a  f88d0002          STRB     r0,[sp,#2]            ;12
00001e  4669              MOV      r1,sp
000020  4620              MOV      r0,r4
000022  f7fffffe          BL       GPIO_Init
;;;14     	GPIO_ResetBits(GPIOD,LDAC_Pin);
000026  2108              MOVS     r1,#8
000028  4620              MOV      r0,r4
00002a  f7fffffe          BL       GPIO_ResetBits
;;;15     }
00002e  bd38              POP      {r3-r5,pc}
;;;16     
                          ENDP

                  |L1.48|
                          DCD      0x40011400

                          AREA ||i.DAC8554_Send_24_bits||, CODE, READONLY, ALIGN=2

                  DAC8554_Send_24_bits PROC
;;;22     
;;;23     void DAC8554_Send_24_bits(unsigned int data)  // data是一个24位的数据,STM32中int型是32位的数据
000000  b570              PUSH     {r4-r6,lr}
;;;24     {
;;;25     	char i=0;
;;;26     
;;;27     	////////////////////////////////
;;;28     	SYNC_1();
000002  4e15              LDR      r6,|L2.88|
000004  4605              MOV      r5,r0                 ;24
000006  2201              MOVS     r2,#1
000008  2400              MOVS     r4,#0                 ;25
00000a  4611              MOV      r1,r2
00000c  4630              MOV      r0,r6
00000e  f7fffffe          BL       GPIO_WriteBit
;;;29     	DAC8554_delay();//////////SYNC脚一个高脉冲
000012  f7fffffe          BL       DAC8554_delay
;;;30     	SYNC_0();
000016  2200              MOVS     r2,#0
000018  2101              MOVS     r1,#1
00001a  4630              MOV      r0,r6
00001c  f7fffffe          BL       GPIO_WriteBit
                  |L2.32|
;;;31     	///////////////////////
;;;32     	for( i=0; i<24; i++ )
;;;33     	{
;;;34     		if((data&0x800000)  == 0x800000)
000020  0228              LSLS     r0,r5,#8
000022  d501              BPL      |L2.40|
;;;35     			DIN_1();  		
000024  2201              MOVS     r2,#1
000026  e000              B        |L2.42|
                  |L2.40|
;;;36     		else
;;;37     			DIN_0();
000028  2200              MOVS     r2,#0
                  |L2.42|
00002a  2104              MOVS     r1,#4
00002c  4630              MOV      r0,r6
00002e  f7fffffe          BL       GPIO_WriteBit
;;;38     			
;;;39     		SCLK_1();
000032  2201              MOVS     r2,#1
000034  2102              MOVS     r1,#2
000036  4630              MOV      r0,r6
000038  f7fffffe          BL       GPIO_WriteBit
;;;40     		DAC8554_delay();
00003c  f7fffffe          BL       DAC8554_delay
;;;41     		SCLK_0();
000040  2200              MOVS     r2,#0
000042  2102              MOVS     r1,#2
000044  4630              MOV      r0,r6
000046  f7fffffe          BL       GPIO_WriteBit
00004a  1c64              ADDS     r4,r4,#1              ;32
;;;42     		data=data<<1;
00004c  006d              LSLS     r5,r5,#1
00004e  b2e4              UXTB     r4,r4                 ;32
000050  2c18              CMP      r4,#0x18              ;32
000052  d3e5              BCC      |L2.32|
;;;43     	}	
;;;44     }
000054  bd70              POP      {r4-r6,pc}
;;;45     /*****************************************************
                          ENDP

000056  0000              DCW      0x0000
                  |L2.88|
                          DCD      0x40011400

                          AREA ||i.DAC8554_delay||, CODE, READONLY, ALIGN=1

                  DAC8554_delay PROC
;;;16     
;;;17     void DAC8554_delay(void)
000000  200a              MOVS     r0,#0xa
                  |L3.2|
;;;18     {
;;;19     	int x = 10;
;;;20       while(--x);
000002  1e40              SUBS     r0,r0,#1
000004  d1fd              BNE      |L3.2|
;;;21     }
000006  4770              BX       lr
;;;22     
                          ENDP


                          AREA ||i.SetAoOut||, CODE, READONLY, ALIGN=2

                  SetAoOut PROC
;;;49     ******************************************************/
;;;50     void SetAoOut(float Parm,unsigned char channel,unsigned char CurrentFlag)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;51     {
000004  460d              MOV      r5,r1
;;;52     	if(Parm<0)Parm=0;
000006  f1104fff          CMN      r0,#0x7f800000
00000a  d300              BCC      |L4.14|
00000c  2000              MOVS     r0,#0
                  |L4.14|
;;;53     	switch(CurrentFlag)
;;;54     	{
;;;55     		case 0:if(Parm>9.999)Parm=9.999;
;;;56     						break;
;;;57     		case 1:if(Parm>19.999)Parm=19.999;
;;;58     						break;
;;;59     		default:break;
;;;60     	}
;;;61     	switch(CurrentFlag)
;;;62     	{
;;;63     		case 0:Dat=Parm/2.0/5.0*65536;break;
00000e  4f32              LDR      r7,|L4.216|
000010  4c32              LDR      r4,|L4.220|
000012  f04f36ff          MOV      r6,#0xffffffff
000016  b112              CBZ      r2,|L4.30|
000018  2a01              CMP      r2,#1                 ;53
00001a  d10b              BNE      |L4.52|
00001c  e006              B        |L4.44|
                  |L4.30|
00001e  4930              LDR      r1,|L4.224|
000020  4288              CMP      r0,r1                 ;55
000022  dd00              BLE      |L4.38|
000024  4608              MOV      r0,r1                 ;55
                  |L4.38|
000026  f7fffffe          BL       __aeabi_f2d
00002a  e022              B        |L4.114|
                  |L4.44|
00002c  492d              LDR      r1,|L4.228|
00002e  4288              CMP      r0,r1                 ;57
000030  db00              BLT      |L4.52|
000032  4608              MOV      r0,r1                 ;57
                  |L4.52|
000034  2100              MOVS     r1,#0                 ;52
000036  2a01              CMP      r2,#1                 ;61
000038  d103              BNE      |L4.66|
;;;64     		case 1:
;;;65     			     if(Parm<=3.98406)                              //3.98406=20*10/(10+40.2)
00003a  4a2b              LDR      r2,|L4.232|
00003c  4290              CMP      r0,r2
00003e  da0a              BGE      |L4.86|
;;;66     					 {
;;;67     						 Dat=0;
000040  8021              STRH     r1,[r4,#0]
                  |L4.66|
;;;68     					 }
;;;69     					 else
;;;70     					 {
;;;71     						 Dat=(Parm-3.98406)/(20.08-3.98406)*10/2/5*65536;break;
;;;72     					 }
;;;73     		default:Dat=0;
000042  8021              STRH     r1,[r4,#0]
                  |L4.68|
;;;74     	}
;;;75     	switch(channel) 
000044  2d09              CMP      r5,#9
000046  d245              BCS      |L4.212|
000048  e8dff005          TBB      [pc,r5]
00004c  44212529          DCB      0x44,0x21,0x25,0x29
000050  2d313539          DCB      0x2d,0x31,0x35,0x39
000054  3d00              DCB      0x3d,0x00
                  |L4.86|
000056  f7fffffe          BL       __aeabi_f2d
00005a  4a24              LDR      r2,|L4.236|
00005c  4b24              LDR      r3,|L4.240|
00005e  f7fffffe          BL       __aeabi_dsub
000062  4a24              LDR      r2,|L4.244|
000064  4b24              LDR      r3,|L4.248|
000066  f7fffffe          BL       __aeabi_ddiv
00006a  2200              MOVS     r2,#0                 ;71
00006c  4b23              LDR      r3,|L4.252|
00006e  f7fffffe          BL       __aeabi_dmul
                  |L4.114|
000072  4632              MOV      r2,r6                 ;63
000074  f7fffffe          BL       __ARM_scalbn
000078  2200              MOVS     r2,#0                 ;63
00007a  463b              MOV      r3,r7                 ;63
00007c  f7fffffe          BL       __aeabi_ddiv
000080  2210              MOVS     r2,#0x10              ;63
000082  f7fffffe          BL       __ARM_scalbn
000086  f7fffffe          BL       __aeabi_d2uiz
00008a  8020              STRH     r0,[r4,#0]            ;63
00008c  e7da              B        |L4.68|
;;;76     	{ 
;;;77     		case 1:DAC8554_Send_24_bits((0x00100000|0x00000000)+Dat);break;
00008e  8820              LDRH     r0,[r4,#0]  ; Dat
000090  f5001080          ADD      r0,r0,#0x100000
000094  e01a              B        |L4.204|
;;;78     		case 2:DAC8554_Send_24_bits((0x00100000|0x00020000)+Dat);break;
000096  8820              LDRH     r0,[r4,#0]  ; Dat
000098  f5001090          ADD      r0,r0,#0x120000
00009c  e016              B        |L4.204|
;;;79     		case 3:DAC8554_Send_24_bits((0x00100000|0x00040000)+Dat);break;
00009e  8820              LDRH     r0,[r4,#0]  ; Dat
0000a0  f50010a0          ADD      r0,r0,#0x140000
0000a4  e012              B        |L4.204|
;;;80     		case 4:DAC8554_Send_24_bits((0x00100000|0x00060000)+Dat);break;
0000a6  8820              LDRH     r0,[r4,#0]  ; Dat
0000a8  f50010b0          ADD      r0,r0,#0x160000
0000ac  e00e              B        |L4.204|
;;;81     		case 5:DAC8554_Send_24_bits((0x00500000|0x00000000)+Dat);break;
0000ae  8820              LDRH     r0,[r4,#0]  ; Dat
0000b0  f50000a0          ADD      r0,r0,#0x500000
0000b4  e00a              B        |L4.204|
;;;82     		case 6:DAC8554_Send_24_bits((0x00500000|0x00020000)+Dat);break;
0000b6  8820              LDRH     r0,[r4,#0]  ; Dat
0000b8  f50000a4          ADD      r0,r0,#0x520000
0000bc  e006              B        |L4.204|
;;;83     		case 7:DAC8554_Send_24_bits((0x00500000|0x00040000)+Dat);break;
0000be  8820              LDRH     r0,[r4,#0]  ; Dat
0000c0  f50000a8          ADD      r0,r0,#0x540000
0000c4  e002              B        |L4.204|
;;;84     		case 8:DAC8554_Send_24_bits((0x00500000|0x00060000)+Dat);break;
0000c6  8820              LDRH     r0,[r4,#0]  ; Dat
0000c8  f50000ac          ADD      r0,r0,#0x560000
                  |L4.204|
0000cc  e8bd41f0          POP      {r4-r8,lr}
0000d0  f7ffbffe          B.W      DAC8554_Send_24_bits
                  |L4.212|
;;;85     		default:break;
;;;86     	}
;;;87     }	
0000d4  e8bd81f0          POP      {r4-r8,pc}
                          ENDP

                  |L4.216|
                          DCD      0x40140000
                  |L4.220|
                          DCD      ||.data||
                  |L4.224|
                          DCD      0x411ffbe7
                  |L4.228|
                          DCD      0x419ffdf4
                  |L4.232|
                          DCD      0x407efad7
                  |L4.236|
                          DCD      0xd96a6a01
                  |L4.240|
                          DCD      0x400fdf5a
                  |L4.244|
                          DCD      0x861a60d4
                  |L4.248|
                          DCD      0x4030188f
                  |L4.252|
                          DCD      0x40240000

                          AREA ||.data||, DATA, ALIGN=1

                  ||Dat||
000000  0000              DCB      0x00,0x00
